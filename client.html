<html>
<head>

	<title>AppShotGenerator</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.6.3/fabric.min.js"></script>

	<style>

		#iphoneContainer {

			position: relative; top: 0; left: 0;
			height: 520px;

		}

		#test {

			position: absolute; top: 130px; left: 70px;

		}

		#myImg {

			position: absolute; top: 113px; left: 60px;

		}


	</style>


</head>
<body>

<input type='file' />
</br>

<img id="iphoneContainer" src="images/white.png">
<img id="myImg" src="#" alt="your image" style="display: none;" width=200 />

<canvas id="canvas" style="display: none;"></canvas>

<a href="#" class="button" id="download" download="my-file-name.png" style="display: none;">Download</a>


<script>

function drawComposite () {

	var img1 = document.getElementById('iphoneContainer');
	var img2 = document.getElementById('myImg');

	var canvas = document.getElementById('canvas');
	var context = canvas.getContext('2d');

	canvas.width = img1.width*5;
	canvas.height = img1.height*5;

	context.globalAlpha = 1.0;
	context.drawImage(img1, 0, 0);
	context.drawImage(img2, 195, 315, 750, 1334);

}

var button = document.getElementById('download');

button.addEventListener('click', function (e) {

	drawComposite();

	var dataURL = canvas.toDataURL('image/png');
    button.href = dataURL;
    console.log(button.href);

});

$(":file").change(function () {
    if (this.files && this.files[0]) {
        var reader = new FileReader();
        reader.onload = imageIsLoaded;
        reader.readAsDataURL(this.files[0]);
    }
});

function imageIsLoaded(e) {
    $('#myImg').attr('src', e.target.result);
    $('#myImg').fadeIn();
    $('#download').fadeIn();
};

</script>


</body>
</html>